{% extends "public/page.html" %}

{% block head %}
  <link rel="stylesheet" href="/static/css/wfbn.css">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@GiveFood_org_uk">
  <meta property="og:title" content="Food Banks In {{ constituency.name }}">
  <link rel="manifest" href="/needs/manifest.json">
  <meta name="description" content="Find out what food banks operate in {{ constituency.name }}, what they are requesting and take action.">
  <meta property="og:image" content="https://www.givefood.org.uk{% url 'public_wfbn_constituency_mp_photo' constituency.slug 'threefour' %}">
{% endblock %}

{% block title %}{{ constituency.name }} Constituency Food Banks - Give Food{% endblock %}

{% block body %}

  <div class="columns">
    <div class="column">
        <h1><a href="/">Give Food</a></h1>
        <nav class="breadcrumb has-arrow-separator" aria-label="breadcrumbs">
          <ul>
            <li><a href="{% url 'public_index' %}">Give Food</a></li>
            <li><a href="{% url 'public_what_food_banks_need' %}">What Food Banks Need</a></li>
            <li><a href="{% url 'public_wfbn_constituencies' %}">Constituencies</a></li>
            <li class="is-active"><a href="#" aria-current="page">{{ constituency.name }}</a></li>
          </ul>
        </nav>
        <div class="columns">
          <div class="column">
            <div id="parlcon_map" style="height:500px;"></div>
          </div>
          <div class="column">
            <h2>{{ constituency.name }} Constituency</h2>

            <img src="{% url 'public_wfbn_constituency_mp_photo' constituency.slug 'threefour' %}" alt="{{ constituency.mp }}" class="mp_photo is-pulled-right">

            <p><a href="https://www.google.co.uk/search?q={{ constituency.name }} constituency">{{ constituency.name }} constituency</a> is represented by <a href="https://www.google.co.uk/search?q={{ constituency.mp }} MP">{{ constituency.mp }} MP</a> of the {{ constituency.mp_party }} party.</p>
            <p>You can write to this MP to politely help them understand that food banks shouldn't exist in our country.</p>
            <a href="https://members.parliament.uk/member/{{ constituency.mp_parl_id }}/contact" class="button is-link">Write</a><br><br>

            <h3 style="clear:right">Food Banks</h3>
            <p>The following food banks operate in the {{ constituency.name }} constituency, and what they are requesting to have donated.</p>
            <table class="table is-narrow is-fullwidth">
              {% for foodbank in constituency.foodbanks %}
                <tr>
                  <td class="foodbank_name"><a href="{{ foodbank.gf_url }}">{{ foodbank.name }}</a></td>
                  <td>
                    {% include "includes/need_text.html" with need_text=foodbank.needs.change_text %}
                  </td>
                </tr>
              {% endfor %}
            </table><br>

            <h3>Anything Wrong Here?</h3>
            <p>We're very keen to get our data right. You can help us by pointing out any mistakes with an email to <a href="mailto:mail@givefood.org.uk">mail@givefood.org.uk</a>, and we'll fix it promptly.</p>
          </div>
          {% if constituency.mp_twitter_handle %}
            <div class="column">
              <div class="twitter-feed">
                <a class="twitter-timeline" href="https://twitter.com/{{ constituency.mp_twitter_handle }}">Tweets by {{ constituency.mp_twitter_handle }}</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
              </div>
            </div>
          {% endif %}
        </div>
    </div>
  </div>

{% endblock %}

{% block script %}

<script src="//maps.googleapis.com/maps/api/js?key={{ gmap_key }}"></script>
<script>
const parl_con_geojson_url = "/api/2/constituency/{{ constituency.slug }}/?format=geojson"
var map

function init_map() {
    var bounds = new google.maps.LatLngBounds();
    map = new google.maps.Map(document.getElementById("parlcon_map"), {
        center: new google.maps.LatLng(55,-4),
        zoom: 6,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    map.data.loadGeoJson(parl_con_geojson_url);

    google.maps.event.addListener(map.data,'addfeature',function(e){
      var bounds = new google.maps.LatLngBounds(); 
      map.data.forEach(function(feature){
        feature.getGeometry().forEachLatLng(function(latlng){
          bounds.extend(latlng);
        });
      });

      map.fitBounds(bounds);
    })

    map.data.addListener('click', (event) => {
        const url = event.feature.getProperty('url');
        if (url) {
          window.location = url;
        };
    });

    map.data.setStyle({
      fillColor: "#000",
      strokeWeight: 0,
    });

}

google.maps.event.addDomListener(window, 'load', init_map);
</script>

{% endblock %}
