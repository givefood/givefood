{% extends "public/page.html" %}
{% load custom_tags %}
{% load i18n %}

{% block head %}

  <link rel="stylesheet" href="/static/css/wfbn.css?v={{ version }}">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@GiveFoodCharity">
  <meta property="og:title" content="{% blocktrans %}What Food Banks Need{% endblocktrans %}">
  <meta property="og:description" content="{% blocktrans %}Use Give Food's tool to find what food banks near you are requesting to have donated{% endblocktrans %}">
  <meta name="description" content="{% blocktrans %}Use Give Food's tool to find what food banks near you are requesting to have donated{% endblocktrans %}">
  <meta property="og:image" content="https://www.givefood.org.uk/static/img/map.png">
  <meta property="og:image:alt" content="{% blocktrans %}Map of UK food banks{% endblocktrans %}">
  <link rel="alternate" type="application/rss+xml" title="Give Food RSS" href="{% url 'wfbn:rss' %}">
  <link rel="manifest" href="{% url 'wfbn:manifest' %}">

  {% if locations %}
    {% for location in locations|slice:"5" %}
      {% if location.type == "organisation" %}  
        <link rel="prefetch" href="{% url 'wfbn:foodbank' location.foodbank_slug %}">
      {% endif %}
      {% if location.type == "location" %}  
        <link rel="prefetch" href="{% url 'wfbn:foodbank_location' location.foodbank_slug location.slug %}">
      {% endif %}
    {% endfor %}
  {% endif %}

{% endblock %}

{% block title %}
  {% if not locations %}
    {% blocktrans %}Find Food Banks To Help{% endblocktrans %}
  {% else %}
    {% if address %}
      {{ address }} {% blocktrans %}food banks{% endblocktrans %}
    {% else %}
      {% if page_title %}
        {{ page_title }} {% blocktrans %}food banks{% endblocktrans %}
      {% else %}
        {% blocktrans %}Find Food Banks To Help{% endblocktrans %}
      {% endif %}
    {% endif %}
  {% endif %} - Give Food
{% endblock %}

{% block body %}

  <div class="columns">
    <div class="column">
      <a href="{% url 'index' %}" class="logo"><img src="/static/img/logo.svg" alt="Give Food"></a>
      {% include 'public/includes/langswitcher.html' %}
    </div>
  </div>

  <div class="columns">
    <div class="column {% if locations %}is-three-fifths{% else %}is-half{% endif %}">

      {% if not page_title %}
        <a id="usemylocationbtn" href="{% url 'wfbn:get_location' %}" class="button is-light is-info" data-url="{% url 'wfbn:index' %}" data-no-instant>{% blocktrans %}Use my location{% endblocktrans %}</a>
        <form id="addressform" action="{% url 'wfbn:index' %}" method="GET">
          <label id="address_label" for="address_field" class="label">{% blocktrans %}Postcode or town{% endblocktrans %}</label>
          <input id="address_field" type="text" name="address" class="input" placeholder="{% blocktrans %}e.g. EX4 6PX or Sheffield{% endblocktrans %}" value="{{ address }}" required aria-required="true">
          <input id="lat_lng_field" type="hidden" name="lat_lng">
          <input type="submit" class="button is-light is-info" value="{% trans 'Go' %}">
        </form>
      {% else %}
        <h1 class="placetitle">Foodbanks in {{ page_title }}</h1>
        <p>Find a food bank near {{ page_title }}, see what they need and how you can help by donating or volunteering.</p>
      {% endif %}

      {% if not is_uk %}
        <p>{% blocktrans %}Sorry, we couldn't use that location. Is it inside the United Kingdom?{% endblocktrans %}</p>
      {% endif %}

      {% if locations %}
        <div id="theresults" class="sections">

          <div class="tabs is-boxed" role="tablist" aria-label="{% blocktrans %}Search results{% endblocktrans %}">
            <ul>
              <li class="is-active" role="presentation">
                <a data-tab="foodbanks" role="tab" aria-selected="true" aria-controls="foodbanks-panel" id="foodbanks-tab">
                  <span>{% blocktrans %}Food banks{% endblocktrans %}</span>
                </a>
              </li>
              <li role="presentation">
                <a data-tab="donationpoints" role="tab" aria-selected="false" aria-controls="donationpoints-panel" id="donationpoints-tab">
                  <span>{% blocktrans %}Donation points{% endblocktrans %}</span>
                </a>
              </li>
            </ul>
          </div>
          
          <div class="foodbanks tabcontent" role="tabpanel" id="foodbanks-panel" aria-labelledby="foodbanks-tab">
            <table class="table needs">
              {% for location in locations %}
                <tr>
                  <td>
                    <a href="{% if location.type == 'organisation' %}{% url 'wfbn:foodbank' location.foodbank_slug %}{% endif %}{% if location.type == 'location' %}{% url 'wfbn:foodbank_location' location.foodbank_slug location.slug %}{% endif %}">{{ location.name }}</a>
                    {% if location.type == "location" %}
                      <div class="parent_org">{% blocktrans %}Part of{% endblocktrans %} <a href="{% url 'wfbn:foodbank' location.foodbank_slug %}">{{ location.foodbank_name }}</a></div>
                    {% endif %}
                    <div class="distance">{{ location.distance_mi|floatformat:2 }}mi {% blocktrans %}away{% endblocktrans %}</div>
                  </td>
                  <td class="need_detail">
                    <div class="fb_needs">
                      {% with change_text=location.latest_need.get_change_text %}
                        {% if change_text == "Nothing" %}
                          {% blocktrans %}Nothing right now, thanks{% endblocktrans %}
                        {% elif change_text == "Unknown" %}
                          {% if location.phone_number %}
                            <img src="/static/img/phone.svg" alt="{% blocktrans %}Phone{% endblocktrans %}" class="contact-icon"> <a href="tel:{{ location.phone_number|full_phone }}">{{ location.phone_number|friendly_phone }}</a>
                            <br>
                          {% endif %}
                          <img src="/static/img/email.svg" alt="{% blocktrans %}Email{% endblocktrans %}" class="contact-icon"> <a href="mailto:{{ location.contact_email }}">{{ location.contact_email }}</a>
                        {% elif change_text == "Facebook" %}
                          {% blocktrans %}Check the foodbank's {% endblocktrans %}
                          <a href="https://www.facebook.com/{% if location.type == 'organisation' %}{{ location.facebook_page }}{% endif %}{% if location.type == 'location' %}{{ location.foodbank.facebook_page }}{% endif %}?ref=givefood.org.uk">{% blocktrans %}Facebook page{% endblocktrans %}</a>
                          {% blocktrans %} for what they need{% endblocktrans %}
                        {% else %}
                          {{ change_text|linebreaks }}
                        {% endif %}
                      {% endwith %}
                      <script src="{% url 'wfbn-generic:foodbank_hit' location.foodbank_slug %}" defer></script>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </table>
          </div>

          <div class="donationpoints tabcontent is-hidden" role="tabpanel" id="donationpoints-panel" aria-labelledby="donationpoints-tab">
            <table class="table donationpoints">
              {% for donationpoint in donationpoints %}
                <tr>
                  <td style="min-width:100px;">
                    {% if donationpoint.place_has_photo %}
                      <a href="{{ donationpoint.url }}">
                        <picture>
                          <source srcset="https://www.givefood.org.uk/cdn-cgi/image/width=150,format=avif{{ donationpoint.photo_url }} 150w, https://www.givefood.org.uk/cdn-cgi/image/width=300,format=avif{{ donationpoint.photo_url }} 300w" type="image/avif">
                          <source srcset="https://www.givefood.org.uk/cdn-cgi/image/width=150,format=webp{{ donationpoint.photo_url }} 150w, https://www.givefood.org.uk/cdn-cgi/image/width=300,format=webp{{ donationpoint.photo_url }} 300w" type="image/webp">
                          <img src="https://www.givefood.org.uk/cdn-cgi/image/width=300{{ donationpoint.photo_url }}" alt="{{ donationpoint.name }}" loading="lazy" class="placephoto" style="width:150px;" sizes="150px">
                        </picture>
                      </a>
                    {% endif %}
                  </td>
                  <td>
                    <a href="{{ donationpoint.url }}">{{ donationpoint.name }}</a>
                    <div class="parent_org">{% blocktrans %}For{% endblocktrans %} <a href="{% url 'wfbn:foodbank' donationpoint.foodbank_slug %}">{{ donationpoint.foodbank_name }}</a></div>
                    <div class="distance">{{ donationpoint.distance_mi|floatformat:2 }}mi {% blocktrans %}away{% endblocktrans %}</div>
                  </td>
                  <td>
                    {% with change_text=donationpoint.foodbank.latest_need.get_change_text %}
                      {% if change_text == "Nothing" %}
                          {% blocktrans %}Nothing right now, thanks{% endblocktrans %}
                        {% elif change_text == "Unknown" %}
                          {% blocktrans %}Sorry. We don't know what's needed here, please contact the food bank{% endblocktrans %}
                        {% elif change_text == "Facebook" %}
                          Check the food bank's <a href="https://www.facebook.com/{{ donationpoint.foodbank.facebook_page }}?ref=givefood.org.uk">Facebook page</a> for what they need
                        {% else %}
                          {{ change_text|linebreaks }}
                        {% endif %}
                    {% endwith %}
                    <script src="{% url 'wfbn-generic:foodbank_hit' donationpoint.foodbank_slug %}" defer></script>
                  </td>
                </tr>
              {% endfor %}
            </table>
          </div>
          
        </div>
      {% endif %}

    </div>

    <div class="column {% if locations %}is-two-fifths{% else %}is-half{% endif %}">
      <div id="map"></div>
      {% include "public/includes/maplegend.html" %}
    </div>
  </div>

{% endblock %}

{% block script %}

  {% include 'public/includes/mapconfig.html' %}
  <script src="/static/js/wfbn-maplibre.js?v={{ version }}" defer></script>
  <script src="/static/js/tabber.js?v={{ version }}" defer></script>

{% endblock %}
