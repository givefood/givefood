{% extends "public/page.html" %}
{% load bulma_tags %}

{% block head %}
  <link rel="stylesheet" href="/static/css/wfbn.css?v={{ version }}">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@GiveFoodCharity">
  <meta property="og:title" content="Write to {{ constituency.mp }}">
  <meta name="description" content="Ask {{ constituency.mp }} what they are doing about food banks in {{ constituency }}">
  <meta property="og:image" content="https://www.givefood.org.uk/static/img/mp/{{ constituency.mp_parl_id }}.jpg">
  <meta property="og:image:alt" content="{{ constituency.mp }}">
{% endblock %}

{% block title %}Write to {{ constituency.mp }} about food banks - Give Food{% endblock %}

{% block body %}

  <div class="columns">
    <div class="column">

      <div class="columns">

        <div class="column is-4">
          <a href="{% url 'index' %}" class="logo"><img src="/static/img/logo.svg" alt="Give Food"></a>
        </div>

      </div>

      <nav class="breadcrumb has-arrow-separator" aria-label="breadcrumbs">
            <ul>
                <li><a href="{% url 'index' %}">Home</a></li>
                <li><a href="{% url 'write:index' %}">Write to your prospective MPs</a></li>
                <li><a href="{% url 'write:constituency' constituency.slug %}">{{ constituency }}</a></li>
            </ul>
      </nav>

      <h1>{{ constituency }}</h1>

      <div class="columns">

          <div class="column is-4">

            {% if postcode %}
                <p>Your postcode {{ postcode|upper }} is in <a href="{% url 'wfbn:constituency' constituency.slug %}">{{ constituency }}</a> constituency.</p>
            {% endif %}

            <div id="map" style="height:300px;"></div>

          </div>

          <div class="column is-6">
            <p>The prospective candidates for {{ constituency }} are...</p>
            <ul>
              {% for candidate in candidates %}
                <li style="clear:left; margin-top:10px;">
                  {% if candidate.has_photo %}
                    <img src="/static/img/2024-candidates/{{ candidate.id }}.jpg" style="float:left;width:120px;margin:0 10px 10px 0;"> 
                  {% else %}
                    <img src="/static/img/default_avatar.svg" style="float:left;width:120px;height:120px;margin:0 10px 10px 0;">
                  {% endif %}
                  <h3>{{ candidate.name }}</h3>
                  <p>
                    {{ candidate.party }}
                    {% if candidate.email %}
                      <a href="{% url 'write:candidate' constituency.slug candidate.id %}" class="button is-pulled-right is-info">Write</a>
                    {% endif %}
                  </p>
                </li>
              {% endfor %}
            </ul>

            <p style="clear:left;margin-top:40px;">Data from <a href="https://democracyclub.org.uk/?ref=givefood.org.uk">Democracy Club</a></p>
          </div>
      </div>

    </div>
  </div>

{% endblock %}

{% block script %}

<script src="https://maps.googleapis.com/maps/api/js?key={{ gmap_key }}&libraries=places"></script>
<script>

const parl_con_geojson_url = "/api/2/constituency/{{ constituency.slug }}/?format=geojson"


var map
var bounds = new google.maps.LatLngBounds();

function init_map() {
  var mapOptions = {
    center: new google.maps.LatLng(55,-4),
    zoom: 6,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
  };
  map = new google.maps.Map(document.getElementById("map"), mapOptions);
  map.data.loadGeoJson(parl_con_geojson_url);
  google.maps.event.addListener(map.data,'addfeature',function(e){
    var bounds = new google.maps.LatLngBounds(); 
    map.data.forEach(function(feature){
      feature.getGeometry().forEachLatLng(function(latlng){
        bounds.extend(latlng);
      });
    });

    map.fitBounds(bounds);
  })

    map.data.setStyle({
        fillColor: "#000",
        strokeWeight: 1,
    });
}


google.maps.event.addDomListener(window, 'load', init_map);

</script>

{% endblock %}

