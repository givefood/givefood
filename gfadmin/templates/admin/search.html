{% extends "admin/page.html" %}

{% block title %}Search - GF Admin{% endblock %}

{% block body %}

    <div class="columns">
        <div class="column">
            <form action="{% url 'admin:search_results' %}" method="get" role="search" aria-label="Search">
                <div class="field has-addons">
                    <div class="control">
                      <input class="input" type="text" name="q" value="{{ query }}" aria-label="Search query">
                    </div>
                    <div class="control">
                      <button class="button is-info is-light">
                        Search
                      </button>
                    </div>
                  </div>
            </form>
        </div>
    </div>

    <div class="columns">

        {% if not foodbanks and not locations and not donationpoints and not constituencies and not needs and not email_subscriptions and not whatsapp_subscriptions and not mobile_subscriptions and not webpush_subscriptions %}
            <div class="column">
                <p>No results, have another go</p>
            </div>
        {% endif %}

        {% if foodbanks %}
            <div class="column">
                <h2>Food Banks</h2>
                <ul>
                    {% for foodbank in foodbanks %}
                        <li>
                            <a href="{% url 'admin:foodbank' foodbank.slug %}">{{ foodbank }}</a>
                            <a href="{% url 'admin:foodbank_edit' foodbank.slug %}" class="button is-light is-small">Edit</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if locations %}
            <div class="column">
                <h2>Locations</h2>
                <ul>
                    {% for location in locations %}
                        <li>
                            <a href="{% url 'admin:foodbank' location.foodbank_slug %}">{{ location }}</a> ({{ location.foodbank_name }})
                            <a href="{% url 'admin:fblocation_edit' location.foodbank_slug location.slug %}" class="button is-light is-small">Edit</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if donationpoints %}
            <div class="column">
                <h2>Donation Points</h2>
                <ul>
                    {% for donationpoint in donationpoints %}
                        <li>
                            <a href="{% url 'admin:foodbank' donationpoint.foodbank_slug %}#donationpoints">{{ donationpoint }}</a> ({{ donationpoint.foodbank_name }})
                            <a href="{% url 'admin:donationpoint_edit' donationpoint.foodbank_slug donationpoint.slug %}" class="button is-light is-small">Edit</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if constituencies %}
            <div class="column">
                <h2>Constituencies</h2>
                <ul>
                    {% for constituency in constituencies %}
                        <li><a href="{% url 'admin:parlcon_form' constituency.slug %}">{{ constituency }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if needs %}
            <div class="column">
                <h2>Needs</h2>
                <ul>
                    {% for need in needs %}
                        <li><a href="{% url 'admin:need' need.need_id %}">{{ need.need_id_short }}</a> {{ need.foodbank_name }}, {{ need.modified }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if email_subscriptions %}
            <div class="column">
                <h2>Email Subscriptions</h2>
                <ul>
                    {% for subscription in email_subscriptions %}
                        <li>
                            {{ subscription.email }} - <a href="{% url 'admin:foodbank' subscription.foodbank.slug %}">{{ subscription.foodbank.name }}</a>
                            {% if subscription.confirmed %}<span class="tag is-success is-light">Confirmed</span>{% else %}<span class="tag is-warning is-light">Unconfirmed</span>{% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if whatsapp_subscriptions %}
            <div class="column">
                <h2>WhatsApp Subscriptions</h2>
                <ul>
                    {% for subscription in whatsapp_subscriptions %}
                        <li>
                            {{ subscription.phone_number }} - <a href="{% url 'admin:foodbank' subscription.foodbank.slug %}">{{ subscription.foodbank.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if mobile_subscriptions %}
            <div class="column">
                <h2>Mobile Subscriptions</h2>
                <ul>
                    {% for subscription in mobile_subscriptions %}
                        <li>
                            {{ subscription.device_id|slice:":20" }}{% if subscription.device_id|length > 20 %}...{% endif %} ({{ subscription.platform }}) - <a href="{% url 'admin:foodbank' subscription.foodbank.slug %}">{{ subscription.foodbank.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if webpush_subscriptions %}
            <div class="column">
                <h2>Web Push Subscriptions</h2>
                <ul>
                    {% for subscription in webpush_subscriptions %}
                        <li>
                            {{ subscription.endpoint|slice:":50" }}{% if subscription.endpoint|length > 50 %}...{% endif %}{% if subscription.browser %} ({{ subscription.browser }}){% endif %} - <a href="{% url 'admin:foodbank' subscription.foodbank.slug %}">{{ subscription.foodbank.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

    </div>

{% endblock %}
