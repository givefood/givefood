{% extends "admin/page.html" %}
{% load humanize %}

{% block title %}Crawl Sets - GF Admin{% endblock %}

{% block body %}

  <h2>Crawl Sets</h2>

  <div class="columns">

    <div class="column is-three-quarters">

      <table class="table is-fullwidth is-hoverable">
        <thead>
            <tr>
                <th>Type</th>
                <th>Start</th>
                <th>Finish</th>
                <th>Time Taken</th>
                <th>Items</th>
                <th>Objects</th>
            </tr>
        </thead>
        <tbody>
          {% for crawl_set in crawl_sets %}
            <tr>
              <td>
                <a href="{% url 'gfadmin:crawl_set' crawl_set.id %}">
                    {{ crawl_set.crawl_type }}
                </a>
              </td>
              <td>{{ crawl_set.start }}</td>
              <td>
                {% if crawl_set.finish %}
                    {{ crawl_set.finish }}
                {% else %}
                    <span style="color:red;">Unfinished</span>
                {% endif %}
              </td>
              <td>
                {% if crawl_set.time_taken %}
                    {{ crawl_set.time_taken }}
                {% endif %}
              </td>
              <td>
                {{ crawl_set.item_count }}
              </td>
              <td>
                {{ crawl_set.object_count }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>

    <div class="column is-one-quarter">
      <h3>Orphaned Items</h3>
      <p style="font-size:0.9em; color:#666;">CrawlItems without CrawlSets</p>
      
      <table class="table is-fullwidth is-hoverable" style="font-size:0.9em;">
        <thead>
            <tr>
                <th>Foodbank</th>
                <th>Start</th>
            </tr>
        </thead>
        <tbody>
          {% for crawl_item in orphaned_crawl_items %}
            <tr>
              <td>
                <a href="{% url 'gfadmin:foodbank' crawl_item.foodbank.slug %}">
                    {{ crawl_item.foodbank.name|truncatewords:3 }}
                </a>
              </td>
              <td>{{ crawl_item.start|date:"Y-m-d H:i" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>

  </div>

{% endblock %}
