{% extends "admin/page.html" %}
{% load humanize %}

{% block title %}Crawl Sets - GF Admin{% endblock %}

{% block body %}

  <div class="columns">

    <div class="column is-three-quarters">

      <h2>Crawl Sets</h2>

      <table class="table is-fullwidth is-hoverable">
        <thead>
            <tr>
                <th>Type</th>
                <th>Start</th>
                <th>Finish</th>
                <th>Time Taken</th>
                <th>Items</th>
                <th>Objects</th>
            </tr>
        </thead>
        <tbody>
          {% for crawl_set in crawl_sets %}
            <tr>
              <td>
                <a href="{% url 'gfadmin:crawl_set' crawl_set.id %}">
                    {{ crawl_set.crawl_type_icon }}
                    {{ crawl_set.crawl_type }}
                </a>
              </td>
              <td>{{ crawl_set.start }}</td>
              <td>
                {% if crawl_set.finish %}
                    {{ crawl_set.finish }}
                {% else %}
                    <span style="color:red;">Unfinished</span>
                {% endif %}
              </td>
              <td>
                {% if crawl_set.time_taken %}
                    {{ crawl_set.time_taken }}
                {% endif %}
              </td>
              <td>
                {{ crawl_set.item_count }}
              </td>
              <td>
                {{ crawl_set.object_count }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>

    <div class="column is-one-quarter">
      <h2>Ad Hoc Crawls</h2>
      
      <table class="table is-fullwidth is-hoverable">
        <thead>
            <tr>
                <th>Foodbank</th>
                <th>Start</th>
                <th>Type</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
          {% for crawl_item in orphaned_crawl_items %}
            <tr>
              <td style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                <a href="{% url 'gfadmin:foodbank' crawl_item.foodbank.slug %}">
                    {{ crawl_item.foodbank.name }}
                </a>
              </td>
              <td>{{ crawl_item.start|date:"Y-m-d H:i" }}</td>
              <td>{{ crawl_item.crawl_type_icon }}&nbsp;{{ crawl_item.crawl_type }}</td>
              <td>
                {% if crawl_item.content_object %}
                  <a href="{{ crawl_item.content_object.get_absolute_url }}">ðŸ”—</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>

  </div>

{% endblock %}
